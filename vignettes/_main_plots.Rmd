# Main results {.tabset .tabset-fade .tabset-pills}

The 3 plots below show the most informative taken from existing data for confirmed cases and deaths.

## Deaths / Confirmed rate

Rate of death per number of confirmed case. Note that this is heavily dependand on the number of tests being performed *(data not available in this report)*

```{r main_plots_death_cases}
death.vs.cases.plot(death.vs.cases, state.filter = countries, expand = FALSE) 
```

## Confirmed Cases

```{r}
suppressWarnings({
  p <- last.days(last.days.dat, 'confirmed', params$last.days, countries, log2.flag = FALSE, per.100k.flag = FALSE, new.flag = TRUE) %>% 
    ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(cumul, big.mark = ',')) %>% 
  select(Country = state,  Date = date,  'Confirmed Cases' = cumul, text) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Confirmed Cases`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = '',
            hovertemplate = paste0('<i>Value:</i> %{text}', '<br><i> Date:</i> %{x}'),
            text = ~text
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```

### Deaths

```{r, warning=FALSE}
suppressWarnings({
  p <- last.days(last.days.dat, 'death', params$last.days, countries, log2.flag = FALSE, per.100k.flag = FALSE, new.flag = TRUE) %>% 
    ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(cumul, big.mark = ',')) %>% 
  select(Country = state,  Date = date,  'Deaths' = cumul, text) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Deaths`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = '',
            hovertemplate = paste0('<b>%{text}</b>', '<br><i>%{x}</i>'),
            text = ~text
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```

## Cases *(/100k)*

New Confirmed Cases *(per 100k population)*.

```{r}
suppressWarnings({
  p <- last.days(last.days.dat, 'confirmed', params$last.days, countries, log2.flag = FALSE, per.100k.flag = TRUE, new.flag = TRUE) %>% 
    ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(round(cumul, digits = 2), big.mark = ','),
         absolute = format(cumul * population / 100000, big.mark = ',', trim = FALSE)) %>% 
  select(Country = state,  Date = date,  'Confirmed Cases' = cumul, text, absolute) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Confirmed Cases`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = ~absolute,
            hovertemplate = paste0('<b>%{text}</b> <i>(%{customdata})</i>', '<br><i>%{x}</i>'),
            text = ~text
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```

### Deaths *(/100k)*

New Deaths *(per 100k population)*.
 
```{r, warning=FALSE}
suppressWarnings({
  p <- last.days(last.days.dat, 'death', params$last.days, countries, log2.flag = FALSE, per.100k.flag = TRUE, new.flag = TRUE) %>% 
    ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(round(cumul, digits = 2), big.mark = ','),
         absolute = format(cumul * population / 100000, big.mark = ',', trim = FALSE)) %>% 
  select(Country = state,  Date = date,  'Deaths' = cumul, text, absolute) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Deaths`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = ~absolute,
            hovertemplate = paste0('<b>%{text}</b> <i>(%{customdata})</i>', '<br><i>%{x}</i>'),
            text = ~text
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```

## Average Cases

Each data point is an average of new cases from the previous 4 days.


```{r main_plots_last_week_cumulative_cases.plotly}
suppressWarnings({
  p <- last.week.cumulative(last.week.dat, 'confirmed', 4, countries, log2.flag = FALSE, per.100k.flag = FALSE) %>% ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(last.week.var, digits = 2, big.mark = ',')) %>% 
  select(Country = state,  Date = date,  'Average Cases' = last.week.var, text) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Average Cases`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = '',
            hovertemplate = paste0('<b>%{text}</b>', '<br><i>%{x}</i>'),
            text = ~text
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```

## Average Deaths

Each data point is an average of new cases from the previous 4 days.

```{r main_plots_last_week_cumulative_deaths.plotly}
suppressWarnings({
  p <- last.week.cumulative(last.week.dat, 'death', 4, countries, log2.flag = FALSE, per.100k.flag = FALSE) %>% ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(last.week.var, big.mark = ',')) %>% 
  select(Country = state,  Date = date,  'Average Cases' = last.week.var, text) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Average Cases`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = '',
            hovertemplate = paste0('<b>%{text}</b>', '<br><i>%{x}</i>'),
            text = ~text
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```

## Average Cases *(/100k)*

Each data point is an average of new cases from the previous 4 days *(per 100k population)*.


```{r main_plots_last_week_cumulative_cases.plotly}
suppressWarnings({
  p <- last.week.cumulative(last.week.dat, 'confirmed', 4, countries, log2.flag = FALSE, per.100k.flag = TRUE) %>% ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(round(last.week.var, digits = 2), big.mark = ','),
         absolute = format(last.week.var * population / 100000, big.mark = ',', trim = FALSE)) %>% 
  select(Country = state,  Date = date,  'Average Cases' = last.week.var, text, absolute) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Average Cases`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = ~absolute,
            hovertemplate = paste0('<b>%{text}</b> <i>(%{customdata})</i>', '<br><i>%{x}</i>'),
            text = ~text
            
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```

## Average Deaths *(/100k)*

Each data point is an average of new cases from the previous 4 days *(per 100k population)*.


```{r main_plots_last_week_cumulative_deaths.plotly}
suppressWarnings({
  p <- last.week.cumulative(last.week.dat, 'death', 4, countries, log2.flag = FALSE, per.100k.flag = TRUE) %>% ggplotly()
})

d <- plotly_data(p) %>%  
  mutate(text = format(round(last.week.var, digits = 2), big.mark = ','),
         absolute = format(last.week.var * population / 100000, big.mark = ',', trim = FALSE)) %>% 
  select(Country = state,  Date = date,  'Average Deaths' = last.week.var, text, absolute) %>% 
  arrange(Date) %>% 
  highlight_key(~Country)

pal <- viridis(plotly_data(p) %>% nrow, end = .8, option = 'A')

d %>% plot_ly() %>% 
  add_trace(x = ~Date, 
            y = ~`Average Deaths`, 
            color = ~Country, 
            type = 'scatter',
            mode = 'lines+markers', 
            colors = pal, 
            name = ~Country,
            customdata = ~absolute,
            hovertemplate = paste0('<b>%{text}</b> <i>(%{customdata})</i>', '<br><i>%{x}</i>'),
            text = ~text
            ) %>% 
  layout(legend = list(x = 0.1, y = 1), dragmode = FALSE) %>% 
  highlight(on = 'plotly_click', off = 'plotly_doubleclick')
```